import e from"fs";import{createRequire as t}from"module";import s from"path";import{getFormatExtension as r}from"../extractor/format/index.js";import n from"../extractor/source/SourceFileFilter.js";import{isNextJs16OrHigher as o,hasStableTurboConfig as a}from"./nextFlags.js";import{throwError as i}from"./utils.js";const l=t(import.meta.url);function u(e){return[`${e}.ts`,`${e}.tsx`,`${e}.js`,`${e}.jsx`]}function c(t,r){function n(t){return e.existsSync(function(e){const t=[];return r&&t.push(r),t.push(e),s.resolve(...t)}(t))}if(t)return n(t)||i(`Could not find i18n config at ${t}, please provide a valid path.`),t;for(const e of[...u("./i18n/request"),...u("./src/i18n/request")])if(n(e))return e;i("Could not locate request configuration module.\n\nThis path is supported by default: ./(src/)i18n/request.{js,jsx,ts,tsx}\n\nAlternatively, you can specify a custom location in your Next.js config:\n\nconst withNextIntl = createNextIntlPlugin(\n\nAlternatively, you can specify a custom location in your Next.js config:\n\nconst withNextIntl = createNextIntlPlugin(\n  './path/to/i18n/request.tsx'\n);")}function m(e,t){const u=null!=process.env.TURBOPACK,m=u||o(),p={};function x(){const t=e.experimental;return t.srcPath&&e.experimental?.messages||i("`srcPath` and `messages` are required when using `extractor`."),{loader:"next-intl/extractor/extractionLoader",options:{srcPath:t.srcPath,sourceLocale:t.extract.sourceLocale,messages:e.experimental.messages}}}function f(){return{loader:"next-intl/extractor/catalogLoader",options:{messages:e.experimental.messages}}}function g(){return t?.turbopack?.rules||t?.experimental?.turbo?.rules||{}}function d(e,t,s){e[t]?Array.isArray(e[t])?e[t].push(s):e[t]=[e[t],s]:e[t]=s}if(e.experimental?.messages){const t=e.experimental.messages;t.format||i("`format` is required when using `messages`."),t.path||i("`path` is required when using `messages`.")}if(m){e.requestConfig&&s.isAbsolute(e.requestConfig)&&i("Turbopack support for next-intl currently does not support absolute paths, please provide a relative one (e.g. './src/i18n/config.ts').\n\nFound: "+e.requestConfig);const u={"next-intl/config":c(e.requestConfig)};if(e.experimental?.messages?.precompile){let e=s.relative(process.cwd(),l.resolve("use-intl/format-message/format-only"));e.startsWith(".")||(e=`./${e}`),u["use-intl/format-message"]=e.replace(/\\/g,"/")}let m;if(e.experimental?.extract){o()||i("Message extraction requires Next.js 16 or higher."),m??=g();const t=(Array.isArray(e.experimental.srcPath)?e.experimental.srcPath:[e.experimental.srcPath]).map((e=>e.endsWith("/")?e.slice(0,-1):e));d(m,`*.{${n.EXTENSIONS.join(",")}}`,{loaders:[x()],condition:{path:`{${t.join(",")}}/**/*`,content:/(useExtracted|getExtracted)/}})}if(e.experimental?.messages){o()||i("Message catalog loading requires Next.js 16 or higher."),m??=g();d(m,`*${r(e.experimental.messages.format)}`,{loaders:[f()],condition:{path:`${e.experimental.messages.path}/**/*`},as:"*.js"})}a()&&!t?.experimental?.turbo?p.turbopack={...t?.turbopack,...m&&{rules:m},resolveAlias:{...t?.turbopack?.resolveAlias,...u}}:p.experimental={...t?.experimental,turbo:{...t?.experimental?.turbo,...m&&{rules:m},resolveAlias:{...t?.experimental?.turbo?.resolveAlias,...u}}}}return u||(p.webpack=function(o,a){if(o.resolve||(o.resolve={}),o.resolve.alias||(o.resolve.alias={}),o.resolve.alias["next-intl/config"]=s.resolve(o.context,c(e.requestConfig,o.context)),e.experimental?.messages?.precompile&&(o.resolve.alias["use-intl/format-message"]=l.resolve("use-intl/format-message/format-only")),e.experimental?.extract){o.module||(o.module={}),o.module.rules||(o.module.rules=[]);const t=e.experimental.srcPath;o.module.rules.push({test:new RegExp(`\\.(${n.EXTENSIONS.join("|")})$`),include:Array.isArray(t)?t.map((e=>s.resolve(o.context,e))):s.resolve(o.context,t||""),use:[x()]})}if(e.experimental?.messages){o.module||(o.module={}),o.module.rules||(o.module.rules=[]);const t=r(e.experimental.messages.format);o.module.rules.push({test:new RegExp(`${t.replace(/\./g,"\\.")}$`),include:s.resolve(o.context,e.experimental.messages.path),use:[f()],type:"javascript/auto"})}return"function"==typeof t?.webpack?t.webpack(o,a):o}),t?.trailingSlash&&(p.env={...t.env,_next_intl_trailing_slash:"true"}),Object.assign({},t,p)}export{m as default};
